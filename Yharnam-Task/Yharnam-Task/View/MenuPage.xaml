<?xml version="1.0" encoding="utf-8" ?>
<ContentPage 
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:app="clr-namespace:Yharnam_Task"
    x:Class="Yharnam_Task.View.MenuPage"
    Title="Yharnam Task List"
    BackgroundColor="{StaticResource BackgroundColorLight}">

    <ContentPage.BindingContext>
        <x:Static Member="app:App.MainViewModel" xmlns:app="clr-namespace:Yharnam_Task"/>
    </ContentPage.BindingContext>

    <Grid>
        <ScrollView>
            <VerticalStackLayout Spacing="25" Padding="20">

                <!-- Encabezado -->
                <VerticalStackLayout Spacing="15" Margin="0,24,0,0">
                    <Label Text="Yharnam Task List" 
                           Style="{StaticResource HeadingLabelStyle}" />

                    <BoxView HeightRequest="1" 
                             Color="#E5E7EB" />

                    <Grid ColumnDefinitions="*, Auto" VerticalOptions="Center">
                        <Label Text="{Binding Tareas.Count, StringFormat='{0} tareas'}" 
                               FontSize="12" 
                               TextColor="{StaticResource TextSecondaryColor}"
                               VerticalOptions="Center"/>

                        <Button Grid.Column="1"
                                Text="Filtrar"
                                BackgroundColor="Transparent"
                                TextColor="{StaticResource PrimaryColor}"
                                FontSize="12"
                                FontAttributes="Bold"
                                BorderColor="{StaticResource PrimaryColor}"
                                BorderWidth="1"
                                HeightRequest="30"
                                CornerRadius="8"
                                Padding="15,0"/>
                    </Grid>
                </VerticalStackLayout>

                <!-- Lista de tareas -->
                <CollectionView ItemsSource="{Binding Tareas}">
                    <CollectionView.EmptyView>
                        <VerticalStackLayout HorizontalOptions="Center" 
                                             VerticalOptions="Center" 
                                             Spacing="20"
                                             Margin="0,100">
                            <Label Text="ðŸ“" 
                                   FontSize="48" 
                                   HorizontalOptions="Center"/>
                            <Label Text="No hay tareas" 
                                   FontSize="16" 
                                   TextColor="{StaticResource TextPrimaryColor}"
                                   HorizontalOptions="Center"/>
                            <Label Text="Agrega tu primera tarea con el botÃ³n +" 
                                   FontSize="12" 
                                   TextColor="{StaticResource TextSecondaryColor}"
                                   HorizontalOptions="Center"/>
                        </VerticalStackLayout>
                    </CollectionView.EmptyView>

                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame BackgroundColor="{StaticResource CardBackgroundColor}" 
                                   Padding="16" 
                                   Margin="0,8"
                                   CornerRadius="18"
                                   HasShadow="True"
                                   BorderColor="#E5E7EB">
                                <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto" 
                                      ColumnDefinitions="*,Auto"
                                      RowSpacing="8">

                                    <!-- TÃ­tulo + fecha -->
                                    <Label Grid.Row="0" Grid.Column="0"
                                           Text="{Binding Titulo}" 
                                           FontAttributes="Bold" 
                                           FontSize="18" 
                                           TextColor="{StaticResource TextPrimaryColor}"
                                           LineBreakMode="TailTruncation"/>

                                    <Label Grid.Row="0" Grid.Column="1"
                                           Text="{Binding FechaEntrega, StringFormat='{0:dd/MM}'}" 
                                           FontSize="11" 
                                           TextColor="{StaticResource TextSecondaryColor}"
                                           HorizontalOptions="End"/>

                                    <!-- DescripciÃ³n -->
                                    <Label Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2"
                                           Text="{Binding Descripcion}" 
                                           FontSize="13" 
                                           TextColor="{StaticResource TextSecondaryColor}"
                                           LineBreakMode="TailTruncation"/>

                                    <!-- Dificultad + tiempo estimado -->
                                    <Grid Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2"
                                          ColumnDefinitions="Auto,*,Auto"
                                          VerticalOptions="Center">

                                        <Frame Grid.Column="0"
                                               BackgroundColor="{Binding DificultadColor}"
                                               Padding="8,4"
                                               CornerRadius="6"
                                               HasShadow="False">
                                            <Label Text="{Binding Dificultad}" 
                                                   FontSize="10" 
                                                   FontAttributes="Bold"
                                                   TextColor="White"/>
                                        </Frame>

                                        <Label Grid.Column="2"
                                               Text="{Binding TiempoEstimadoHoras, StringFormat='{0:F1}h'}" 
                                               FontSize="11" 
                                               TextColor="{StaticResource PrimaryColor}"
                                               FontAttributes="Bold"
                                               HorizontalOptions="End"/>
                                    </Grid>

                                    <!-- Barra de progreso (fondo) -->
                                    <BoxView Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2"
                                             HeightRequest="4"
                                             Color="#E5E7EB"
                                             CornerRadius="2"/>

                                    <!-- Barra de progreso (foreground fijo) -->
                                    <BoxView Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2"
                                             HeightRequest="4"
                                             Color="{StaticResource PrimaryColor}"
                                             CornerRadius="2"
                                             WidthRequest="60"/>

                                    <!-- Prioridad -->
                                    <StackLayout Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="2"
                                                 Orientation="Horizontal"
                                                 HorizontalOptions="End"
                                                 Spacing="10">
                                        <Label Text="{Binding PrioridadResumen}"
                                               FontSize="10"
                                               TextColor="{StaticResource TextSecondaryColor}"/>
                                        <Label Text="{Binding PrioridadCalculada, StringFormat='Prioridad: {0:F1}'}"
                                               FontSize="12"
                                               FontAttributes="Bold"
                                               TextColor="#F59E0B"/>
                                    </StackLayout>
                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

            </VerticalStackLayout>
        </ScrollView>

        <!-- BotÃ³n flotante + -->
        <Button Text="+" 
                FontSize="24"
                BackgroundColor="{StaticResource PrimaryColor}"
                TextColor="White"
                WidthRequest="60"
                HeightRequest="60"
                CornerRadius="30"
                HorizontalOptions="End"
                VerticalOptions="End"
                Margin="20"
                Clicked="OnPopupButtonClicked"/>
    </Grid>
</ContentPage>
