<?xml version="1.0" encoding="utf-8" ?>
<toolkit:Popup xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
               xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
               xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
               x:Class="Yharnam_Task.View.PopupView"
               CanBeDismissedByTappingOutsideOfPopup="True"
               Background="#80000000">

    <toolkit:Popup.Content>

        <Frame BackgroundColor="{StaticResource CardBackgroundColor}" 
               CornerRadius="20" 
               Padding="20"
               HorizontalOptions="Center" 
               VerticalOptions="Center"
               WidthRequest="400"
               HeightRequest="620"
               HasShadow="True"
               BorderColor="#E5E7EB">

            <ScrollView>
                <VerticalStackLayout Spacing="30"
                                     Padding="10">

                    <!-- Header popup -->
                    <Grid>
                        <Button Text="✕" 
                                FontSize="16"
                                BackgroundColor="Transparent"
                                TextColor="#EF4444"
                                WidthRequest="32"
                                HeightRequest="32"
                                CornerRadius="16"
                                HorizontalOptions="End"
                                Clicked="CerrarPopup_Clicked" />

                        <Label Text="Nueva tarea" 
                               FontSize="20" 
                               FontAttributes="Bold" 
                               TextColor="{StaticResource TextPrimaryColor}"
                               HorizontalOptions="Center" />
                    </Grid>

                    <BoxView HeightRequest="1" Color="#E5E7EB" />

                    <VerticalStackLayout Spacing="20">

                        <!-- Título -->
                        <VerticalStackLayout Spacing="8">
                            <Label Text="TÍTULO *" 
                                   FontSize="11" 
                                   FontAttributes="Bold" 
                                   TextColor="{StaticResource TextSecondaryColor}" />
                            <Entry x:Name="TituloEntry" 
                                   Placeholder="Ingresa el título de la tarea..." 
                                   PlaceholderColor="{StaticResource EntryPlaceholderColor}"
                                   Text="{Binding NuevoTitulo}"
                                   TextColor="{StaticResource TextPrimaryColor}"
                                   BackgroundColor="#F9FAFB"
                                   Margin="0,4,0,0"
                                   HeightRequest="44"
                                   ClearButtonVisibility="WhileEditing" />
                        </VerticalStackLayout>

                        <!-- Descripción -->
                        <VerticalStackLayout Spacing="8">
                            <Label Text="DESCRIPCIÓN" 
                                   FontSize="11" 
                                   FontAttributes="Bold" 
                                   TextColor="{StaticResource TextSecondaryColor}" />
                            <Editor x:Name="DescripcionEditor" 
                                    Placeholder="Descripción opcional..." 
                                    PlaceholderColor="{StaticResource EntryPlaceholderColor}"
                                    AutoSize="TextChanges"
                                    BackgroundColor="#F9FAFB"
                                    Margin="0,4,0,0"
                                    Text="{Binding NuevaDescripcion}" 
                                    TextColor="{StaticResource TextPrimaryColor}"/>
                        </VerticalStackLayout>

                        <!-- Fecha + Dificultad -->
                        <Grid ColumnDefinitions="*, *" ColumnSpacing="15">
                            <VerticalStackLayout Grid.Column="0" Spacing="8">
                                <Label Text="FECHA ENTREGA" 
                                       FontSize="11" 
                                       FontAttributes="Bold" 
                                       TextColor="{StaticResource TextSecondaryColor}" />
                                <DatePicker x:Name="FechaEntregaDatePicker" 
                                            Date="{Binding FechaEntrega}"
                                            MinimumDate="{Binding Today}"
                                            BackgroundColor="#F9FAFB"
                                            Format="dd/MM/yyyy"
                                            TextColor="{StaticResource TextPrimaryColor}" />
                            </VerticalStackLayout>

                            <VerticalStackLayout Grid.Column="1" Spacing="8">
                                <Label Text="DIFICULTAD" 
                                       FontSize="11" 
                                       FontAttributes="Bold" 
                                       TextColor="{StaticResource TextSecondaryColor}" />
                                <Picker x:Name="DificultadPicker"
                                        SelectedItem="{Binding DificultadSeleccionada}"
                                        BackgroundColor="#F9FAFB"
                                        TextColor="{StaticResource TextPrimaryColor}"
                                        FontSize="14"
                                        HeightRequest="44"
                                        HorizontalOptions="Fill"
                                        HorizontalTextAlignment="Start"
                                        TitleColor="{StaticResource EntryPlaceholderColor}">
                                    <Picker.Items>
                                        <x:String>Fácil</x:String>
                                        <x:String>Media</x:String>
                                        <x:String>Difícil</x:String>
                                    </Picker.Items>
                                </Picker>
                            </VerticalStackLayout>
                        </Grid>

                        <!-- Tiempo estimado -->
                        <VerticalStackLayout Spacing="8">
                            <Label Text="TIEMPO ESTIMADO" 
                                   FontSize="11" 
                                   FontAttributes="Bold" 
                                   TextColor="{StaticResource TextSecondaryColor}" />
                            <Frame BackgroundColor="#F9FAFB" 
                                   CornerRadius="10" 
                                   Padding="20,15" 
                                   HasShadow="False"
                                   BorderColor="#E5E7EB">
                                <VerticalStackLayout Spacing="15">
                                    <Label Text="{Binding TiempoDisplay}"
                                           FontSize="16"
                                           FontAttributes="Bold"
                                           TextColor="{StaticResource PrimaryColor}"
                                           HorizontalOptions="Center"/>

                                    <Slider x:Name="TiempoSlider"
                                            Minimum="15"
                                            Maximum="480"
                                            Value="{Binding TiempoEstimadoMinutos}"
                                            MinimumTrackColor="{StaticResource PrimaryColor}"
                                            MaximumTrackColor="#D1D5DB"
                                            ThumbColor="{StaticResource PrimaryColor}"
                                            HeightRequest="30"/>

                                    <Grid ColumnDefinitions="*, *" 
                                          HorizontalOptions="Fill"
                                          ColumnSpacing="0">
                                        <Label Grid.Column="0"
                                               Text="15m"
                                               FontSize="9"
                                               TextColor="{StaticResource TextSecondaryColor}"
                                               HorizontalOptions="Start"/>
                                        <Label Grid.Column="1"
                                               Text="8h"
                                               FontSize="9"
                                               TextColor="{StaticResource TextSecondaryColor}"
                                               HorizontalOptions="End"/>
                                    </Grid>
                                </VerticalStackLayout>
                            </Frame>
                        </VerticalStackLayout>

                    </VerticalStackLayout>

                    <!-- Botón guardar -->
                    <Grid ColumnDefinitions="*, *" ColumnSpacing="12" Margin="0,20,0,0">
                        <Button Grid.Column="1" 
                                Text="GUARDAR TAREA" 
                                BackgroundColor="{StaticResource PrimaryColor}"
                                TextColor="White"
                                FontSize="14"
                                FontAttributes="Bold"
                                HeightRequest="48"
                                CornerRadius="12"
                                Clicked="CrearTarea_Clicked" />
                    </Grid>

                </VerticalStackLayout>
            </ScrollView>

        </Frame>

    </toolkit:Popup.Content>

</toolkit:Popup>
